#include <LiquidCrystal.h>

LiquidCrystal lcd(8, 9, 4, 5, 6, 7); // for lcd keypad shield

int ledPower = 12; // Sensor Pin 3 - D12
int dustPin = A5;  // Sensor Pin 5 - A5

int delayTime = 280;
int delayTime2 = 40;
float offTime = 9680;

void setup() {
  pinMode(ledPower, OUTPUT);
  pinMode(dustPin, INPUT);

  lcd.begin(16, 2);
  lcd.print("Air Quality!");
}
 
void loop() {
  digitalWrite(ledPower, LOW); // power on the LED
  delayMicroseconds(delayTime);

  float dustVal = analogRead(dustPin); 
  
  delayMicroseconds(delayTime2);
  digitalWrite(ledPower, HIGH); // turn the LED off
  delayMicroseconds(offTime);

  // calculate dust density
  // http://www.howmuchsnow.com/arduino/airquality/
  // y (dust density mg/m3) = 0.172*x - 0.0999
  float dustDensity = (0.172*(dustVal*(5/1024.0))-0.0999)*1000;

  // LCD output
  lcd.setCursor(0, 1);
  lcd.print("Dust:");
  lcd.print(dustDensity);
  lcd.print("ug/m3    ");

  // wait 1 second
  delay(1000);
}
